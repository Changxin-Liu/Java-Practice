package pacman.game;

import org.junit.After;
import org.junit.Before;
import org.junit.Test;
import pacman.ghost.Ghost;
import pacman.ghost.GhostType;
import pacman.util.Position;
import pacman.util.UnpackableException;

import java.io.BufferedReader;
import java.io.FileReader;
import java.io.IOException;
import java.io.StringReader;

import static org.junit.Assert.*;

public class GameReaderTest {

    private static BufferedReader bufferedReader;

    @Before
    public void setUp() throws Exception {
        String gameReaderTest = ";" + System.lineSeparator() +
                ";" + System.lineSeparator() +
                ";" + System.lineSeparator() +
                "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001X" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scores]" + System.lineSeparator() +
                "Ben:32" + System.lineSeparator() +
                "Joe:22" + System.lineSeparator() +
                "Tony:99" +  System.lineSeparator();
        bufferedReader = new BufferedReader
                (new StringReader(gameReaderTest));

    }

    @After
    public void tearDown() throws Exception {
        try {
            bufferedReader.close();
        }catch (Exception e){
            System.err.println("Error closing file");
        }
    }

    @Test
    public void read() throws UnpackableException, IOException {

        PacmanGame pacmanGame;

        try {
            pacmanGame = GameReader.read(bufferedReader);

        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }

        assertEquals("GameReaderTest", pacmanGame.getTitle());
        assertEquals("Changxin Liu s4524500", pacmanGame.getAuthor());
        assertEquals("8,7", new Position(pacmanGame.getBoard().getWidth(),
                pacmanGame.getBoard().getHeight()).toString());
        assertEquals(999, pacmanGame.getScores().getScore());
        assertEquals("5,4,DOWN,15,HUNGRY", pacmanGame.getHunter().toString());
        for (Ghost ghost : pacmanGame.getGhosts()) {
            if (ghost.getType() == GhostType.BLINKY) {
                assertEquals("3,2,LEFT,FRIGHTENED:12", ghost.toString());
            } else if (ghost.getType() == GhostType.INKY) {
                assertEquals("4,5,RIGHT,CHASE:10", ghost.toString());
            } else if (ghost.getType() == GhostType.PINKY) {
                assertEquals("1,5,UP,SCATTER:2", ghost.toString());
            } else if (ghost.getType() == GhostType.CLYDE) {
                assertEquals("3,3,UP,SCATTER:8", ghost.toString());
            }
        }

        assertEquals("[Ben : 32, Joe : 22, Tony : 99]", pacmanGame.getScores().getEntriesByName().toString());
        assertEquals("XXXXXXXX\n" +
                "X010000X\n" +
                "XP00001X\n" +
                "X000X00X\n" +
                "X$00000X\n" +
                "XB0000bX\n" +
                "XXXXXXXX", pacmanGame.getBoard().toString());
    }

    @Test (expected = UnpackableException.class)
    public void read2() throws UnpackableException, IOException {
        String test2 = "" + System.lineSeparator() +
                "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001X" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scres]" + System.lineSeparator() +
                "Ben : 32" + System.lineSeparator() +
                "Joe : 22" + System.lineSeparator() +
                "Tony : 99";;
        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test2));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }

    @Test
    public void read3() throws UnpackableException, IOException {
        String test3 = "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001X" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scres]" + System.lineSeparator() +
                "Ben:32" + System.lineSeparator() +
                "Joe:22" + System.lineSeparator() +
                "Tony:99";

        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test3));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }

    @Test (expected = UnpackableException.class)
    public void read4() throws UnpackableException, IOException {
        String test4 = "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scores]" + System.lineSeparator() +
                "Ben : 32" + System.lineSeparator() +
                "Joe : 22" + System.lineSeparator() +
                "Tony : 99";

        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test4));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }

    @Test (expected = UnpackableException.class)
    public void read5() throws UnpackableException, IOException {
        String test4 = "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scores]" + System.lineSeparator() +
                "Ben : 32" + System.lineSeparator() +
                "Joe : 22" + System.lineSeparator() +
                "Tony : 99";

        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test4));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }

    @Test (expected = UnpackableException.class)
    public void read6() throws UnpackableException, IOException {
        String test4 = "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001X" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5@" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LE,FT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "" + System.lineSeparator() +
                "[Scores]" + System.lineSeparator() +
                "Ben : 32" + System.lineSeparator() +
                "Joe : 2!2" + System.lineSeparator() +
                "Tony : 99";

        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test4));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }

    @Test (expected = UnpackableException.class)
    public void read7() throws UnpackableException, IOException {
        String test4 = "[Board]" + System.lineSeparator() +
                "8,7" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "X010000X" + System.lineSeparator() +
                "XP00001X" + System.lineSeparator() +
                "X000X00X" + System.lineSeparator() +
                "X$00000X" + System.lineSeparator() +
                "XB0000bX" + System.lineSeparator() +
                "XXXXXXXX" + System.lineSeparator() +
                "[Game]" + System.lineSeparator() +
                "title = GameReaderTest" + System.lineSeparator() +
                "author = Changxin Liu s4524500" + System.lineSeparator() +
                "lives = 10" + System.lineSeparator() +
                "level = 5" + System.lineSeparator() +
                "score = 999" + System.lineSeparator() +
                "hunter = 5,4,DOWN,15,HUNGRY" + System.lineSeparator() +
                "blinky = 3,2,LEFT,FRIGHTENED:12" + System.lineSeparator() +
                "inky = 4,5,RIGHT,CHASE:10" + System.lineSeparator() +
                "pinky = 1,5,UP,SCATTER:2" + System.lineSeparator() +
                "clyde = 3,3,UP,SCATTER:8" + System.lineSeparator() +
                "[Scores]" + System.lineSeparator() +
                "Ben : 32" + System.lineSeparator() +
                "Joe : 22" + System.lineSeparator() +
                "Tony : 99";

        BufferedReader bufferedReader1 = new BufferedReader(new StringReader(test4));

        try{
            PacmanGame pacmanGame = GameReader.read(bufferedReader1);
        } catch (UnpackableException e){
            throw new UnpackableException();
        } catch (IOException e){
            throw new IOException();
        }
    }
}
